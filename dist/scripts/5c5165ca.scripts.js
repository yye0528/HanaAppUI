"use strict";angular.module("dataManager",["underscore"]).factory("dataLoader",["$resource",function(a){return a("data/:data")}]).factory("dataStore",["_","$log",function(a){var b={},c=[],d=function(){return(new Date).getTime()};return{push:function(b,e){if(!a.isEmpty(e)){var f=d(),g=a.isEmpty(b)?f:b;c.push({name:g,data:e})}},getDataList:function(){return a.pluck(c,"name")},getContainer:function(){return c},getDataByName:function(b){return a.where(c,{name:b})[0]},getCurrentItem:function(){return b},setCurrentItem:function(a){b=a}}}]).factory("dataTransformer",["_","$log",function(a,b){return{getNumericColomns:function(b,c){var d=[];return a.each(b,function(b,e){for(var f=!0,g=0;g<c.length;g++)if(!a.isNumber(c[g][e])){f=!1;break}f&&d.push(b)}),d},LRTonvd3Scatter:function(b,c,d,e){var f=b.input.columns,g=[];a.each(b.input.values,function(b){g.push({x:b[f.indexOf(c)]+1e-8*Math.random(),y:b[f.indexOf(d)]+1e-8*Math.random(),size:a.isEmpty(e)?100:b[f.indexOf(e)]+1e-8*Math.random()})});var h=[];a.each(b.predicted.values,function(b){h.push({x:b[f.indexOf(c)]+1e-8*Math.random(),y:b[f.indexOf(d)]+1e-8*Math.random(),size:a.isEmpty(e)?100:b[f.indexOf(e)]+1e-8*Math.random()})});var i=[{key:"Predicted",color:"#FF2F00",values:h},{key:"Input",color:"00D0FF",values:g}];return i},DTToStockPredition:function(c,d,e){var f=c.input.columns,g=function(a){if("STOCK_CLOSE_PRICE"!==e)return"circle";var b;return b="UP"===a?"triangle-up":"DOWN"===a?"triangle-down":"square"},h=[],i=a.pluck(c.predicted.values,0);a.each(c.input.values,function(b){var c=b[f.indexOf("ID")];a.contains(i,c)||h.push({x:"DATE"===d?d3.time.format("%m/%d/%Y").parse(b[f.indexOf(d)]):b[f.indexOf(d)],y:"DATE"===e?d3.time.format("%m/%d/%Y").parse(b[f.indexOf(e)]):b[f.indexOf(e)],shape:"circle",size:100})});var j=[];a.each(c.predicted.values,function(a){j.push({x:"DATE"===d?d3.time.format("%m/%d/%Y").parse(a[f.indexOf(d)]):a[f.indexOf(d)],y:"DATE"===e?d3.time.format("%m/%d/%Y").parse(a[f.indexOf(e)]):a[f.indexOf(e)],shape:g(a[f.indexOf("STOCK_TREND")]),size:100})});var k=[{key:"Training set",color:"#00D0FF",values:h},{key:"Predicted",color:"#FF2F00",values:j}];return b.log(k),k},DTToStockGrid:function(b,c,d){var e=a.isArray(d)?d:[],f=b.columns;return a.each(b.values,function(b){var d={};a.each(f,function(a,c){d[a]=b[c]}),d.$group=c,e.push(d)}),e},LRToGrid:function(b){var c=[],d=b.input.columns;return a.each(b.input.values,function(b){var e={};a.each(d,function(a,c){e[a]=b[c]}),e.$group="input",c.push(e)}),a.each(b.predicted.values,function(b){var e={};a.each(d,function(a,c){e[a]=b[c]}),e.$group="predicted",c.push(e)}),c}}}]),angular.module("controllers",["dataManager","underscore","ngDropdowns"]).controller("tabsCtrl",["$scope","$log",function(a){a.tabs=[{title:"Table View",imgUrl:"/images/icons/grid-26.png",contentUrl:"/views/tab-content-grid.html",active:!0},{title:"Scatter Plot",imgUrl:"/images/icons/scatter_plot-25.png",contentUrl:"/views/tab-content-scatter.html",active:!1},{title:"Trend Prediction",imgUrl:"/images/icons/scatter_plot-25.png",contentUrl:"/views/tab-content-stock-trend.html",active:!1}]}]).controller("scatterCtrl",["$scope","$log","_","dataLoader","dataStore","dataTransformer","$q",function(a,b,c,d,e,f,g){a.showPlaceholder=!0,a.showError=!1;var h={};g.all([d.get({data:"input.json"}).$promise,d.get({data:"predicted_1d.json"}).$promise]).then(function(b){h.input=b[0],h.predicted=b[1],a.columns=f.getNumericColomns(h.input.columns,h.input.values),a.attrOptions=[],c.each(a.columns,function(b){a.attrOptions.push({attrName:b,value:b})}),a.attrOptions.push({attrName:"DATE",value:"DATE"}),a.attrForX={attrName:"DATE",value:"DATE"},a.attrForY={attrName:"STOCK_CLOSE_PRICE",value:"STOCK_CLOSE_PRICE"},a.axisChange(),a.showPlaceholder=!1},function(c){a.showPlaceholder=!1,a.showError=!0,b.log("data loading failed. reason: "+c)}),a.axisChange=function(){if(a.attrForX.value&&a.attrForY.value){var b=f.DTToStockPredition(h,a.attrForX.value,a.attrForY.value);b[0].key="Input data",c.each(b[1].values,function(a){a.shape="circle",b[0].values.push(a)}),b.splice(1,1),a.data=b}},a.getShape=function(){return function(a){return a.shape}},a.xAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForX.value?b:c;return d},a.yAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForY.value?b:c;return d}}]).controller("stockCtrl",["$scope","$log","_","dataLoader","dataStore","dataTransformer","$q",function(a,b,c,d,e,f,g){a.showPlaceholder=!0,a.showError=!1;var h={};g.all([d.get({data:"input.json"}).$promise,d.get({data:"predicted_1d.json"}).$promise]).then(function(b){h.input=b[0],h.predicted=b[1],a.columns=f.getNumericColomns(h.input.columns,h.input.values),a.attrOptions=[],c.each(a.columns,function(b){a.attrOptions.push({attrName:b,value:b})}),a.attrOptions.push({attrName:"DATE",value:"DATE"}),a.attrForX={attrName:"DATE",value:"DATE"},a.attrForY={attrName:"STOCK_CLOSE_PRICE",value:"STOCK_CLOSE_PRICE"},a.axisChange(),a.showPlaceholder=!1},function(c){a.showPlaceholder=!1,a.showError=!0,b.log("data loading failed. reason: "+c)}),a.axisChange=function(){a.attrForX.value&&a.attrForY.value&&(a.data=f.DTToStockPredition(h,a.attrForX.value,a.attrForY.value))},a.getShape=function(){return function(a){return a.shape}},a.xAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForX.value?b:c;return d},a.yAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForY.value?b:c;return d}}]).controller("gridCtrl",["_","$scope","$log","dataLoader","dataStore","dataTransformer",function(a,b,c,d,e,f){b.showPlaceholder=!0,b.showError=!1,b.gridData=[],b.columnDefs=[],b.gridOptions={data:"gridData",enablePinning:!0,enableColumnResize:!0,columnDefs:"columnDefs"};var g=[];d.get({data:"testdata.json"},function(c){b.columns=c.input.columns,a.each(b.columns,function(a){var b={field:a};g.push(b)}),g.push({field:"$group",displayName:"Group"}),b.columnDefs=g,b.gridData=f.LRToGrid(c),b.showPlaceholder=!1},function(a){b.showPlaceholder=!1,b.showError=!0,c.log("data loading failed. reason: "+a)})}]).controller("stockGridCtrl",["_","$scope","$log","dataLoader","dataStore","dataTransformer",function(a,b,c,d,e,f){b.showPlaceholder=!0,b.showError=!1,b.gridData=[],b.columnDefs=[],b.gridOptions={data:"gridData",enablePinning:!0,enableColumnResize:!0,columnDefs:"columnDefs"};var g=[];d.get({data:"PAL.stock_1d.json"},function(c){b.columns=c.columns,a.each(b.columns,function(a){var b={field:a};g.push(b)}),g.push({field:"$group",displayName:"Group"}),b.columnDefs=g,b.gridData=f.DTToStockGrid(c,"input"),b.showPlaceholder=!1},function(a){b.showPlaceholder=!1,b.showError=!0,c.log("data loading failed. reason: "+a)})}]),angular.module("visDirectives",[]).directive("visScatter",function(){return{restrict:"EA",templateUrl:"/views/vis-scatter-template.html",scope:!0}}).directive("visStockTrend",function(){return{restrict:"EA",templateUrl:"/views/vis-stock-template.html",scope:!0}}).directive("visGrid",function(){return{restrict:"EA",templateUrl:"/views/vis-grid-template.html",scope:!0}}),angular.module("webApp",["ngCookies","ngResource","ngSanitize","ngRoute","underscore","dataManager","controllers","visDirectives","nvd3ChartDirectives","ngDropdowns","ui.bootstrap","ngGrid"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"/views/vis-select-tabs.html"}).otherwise({redirectTo:"/"})}]);